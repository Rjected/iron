#!/bin/bash

set -e -o pipefail

get_rev () {
    local exe=${1}
    $exe version -version | sed -rn 's;^ssh://.*_([0-9a-f]*\+?)$;\1;p'
}
export -f get_rev

root=$(hg root --cwd $(readlink -f $(dirname $BASH_SOURCE)))

prod=$(get_rev fe)
dev=$(get_rev ${root}/app/fe/bin/fe.exe)

hg diff -r ${prod} -r ${dev%%+} ${root}/app/fe/bin/supported-*-rpcs-for-review

case ${dev} in
    *\+)
        echo "WARNING! Don't roll this binary.  It has a plus revision: ${dev}" >/dev/stderr
        ;;
    *)
        ;;
esac
# We assume we didn't roll a prod binary off a plus revision.
